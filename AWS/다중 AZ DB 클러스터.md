

## 0. 다중 AZ DB 클러스터

다중 AZ DB 클러스터에서는 Amazon RDS가 DB엔진의 네이티브 복제 기능을 사용하여 라이터 DB의 인스턴스를 리더 DB 인스턴스로 복제한다. 변경 사항을 커밋하고 적용하려면 하나 이상의 리더 DB 인스턴스의 승인을 받아야한다. 

리더 DB 인스턴스의 역할

- 자동 장애 조치 대상
- 읽기 트래픽을 제공하여 애플리케이션 읽기 처리량을 높힘

![Untitled](https://user-images.githubusercontent.com/43038052/154173485-379ab0df-8011-457d-86cd-0b26acc456f0.png)

<br>

### 0.1 다중 AZ 클러스터 엔드포인트

**클러스터 엔드포인트**

클러스터 엔드포인트(라이터 엔드포인트) 는 해당 DB 클러스터의 라이터 DB 인스턴스에 연결된다. DDL 및 DML 문과 같은 쓰기 작업이 가능하며 읽기 작업 또한 가능하다.

각 다중 AZ DB 클러스터에는 클러스터 엔드포인트와 라이터 DB 인스턴스가 하나씩 존재한다.

클러스터 엔드포인트는 DB 클러스터에 대한 읽기/쓰기 연결 시 장애 조치를 지원한다. 현재 DB 라이터 인스턴스에 장애가 발생하면 다중 AZ DB 클러스터가 자동으로 새 라이터 DB 인스턴스로 장애 조치를 수행한다. 

장애 조치가 이루어지는 동안에도 DB 클러스터가 새로운 라이터 DB 인스턴스의 클러스터 엔드포인트 연결 요청을 처리하여 서비스 중단 시간을 최소화한다.

[mydbcluster.cluster-123456789012.us-east-1.rds.amazonaws.com](http://mydbcluster.cluster-123456789012.us-east-1.rds.amazonaws.com/)

<br>

**리더 엔드포인트**

다중 AZ DB 클러스터의 리더 엔드포인트는 DB 클러스터에 대한 읽기 전용 연결을 위한 로드 밸런싱을 지원한다. 리더 DB 인스턴스에서 읽기 작업을 처리하여 라이터 DB 인스턴스의 오버헤드를 줄일 수 있다. 

리더 엔드포인트를 사용하는 세션의 경우 SELECT 작업만 사용할 수 있다.

[mydbcluster.cluster-](http://mydbcluster.cluster-ro-123456789012.us-east-1.rds.amazonaws.com/)[**ro**](mydbcluster.cluster-ro-123456789012.us-east-1.rds.amazonaws.com)[-123456789012.us-east-1.rds.amazonaws.com](http://mydbcluster.cluster-ro-123456789012.us-east-1.rds.amazonaws.com/)

<br>

**인스턴스 엔드포인트**

인스턴스 엔드포인트는 다중 AZ DB 클러스터에 있는 특정 DB 인스턴스에 연결된다. 

<br>

### 0.2 다중 AZ DB 엔드포인트가 고가용성으로 작동하는 방법

고가용성이 중요한 다중 AZ DB 클러스터의 경우 라이터 엔드포인트를 읽기/쓰기 등 범용 연결에 사용하고 리더 엔드포인트를 전용 연결에 사용한다. 

DB 클러스터의 기본 DB 인스턴스에 장애가 발생하면 Amazon RDS가 자동으로 새로운 라이터 DB 인스턴스로 장애 조치를 실행한다. **이 때 리더 DB 인스턴스를 새로운 라이터 DB 인스턴스로 승격하여 이를 수행한다.** 장애 조치가 발생하면 기존 라이터 엔드포인트를 사용하여 새롭게 승격된 라이터 DB 인스턴스에 연결이 가능하다. 또는 리더 엔드포인트를 사용하여 DB 클러스터에서 리더 DB 인스턴스 중 하나에 다시 연결 가능하다. 

<br>

**순서 정리**

라이터 장애 → 기존 리더가 라이터로 변경 → (잠시 동안 리더 엔드포인트가 새 라이터 DB 인스턴스에 연결 가능) → 기존 라이터의 작업 완료 후 리더 DB 인스턴스에 적용 → Failover 완료

<br>
