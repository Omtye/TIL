# 1장 SQL 처리 과정과 I/O



## SQL 공유 및 재사용



### 소프트 파싱 VS 하드 파싱

SQL 파싱, 최적화 로우 소스 생성 과정을 거쳐 생성한 프로시저를 반복 재사용할 수 있도록 캐싱해 두는 메모리 공간을 `라이브러리 캐시`라고 한다. 라이브러리 캐시는 SGA의 구성요소 이며 SGA는 서버 프로세스와 백드라운드 프로세스가 공통으로 액세스하는 데이터와 제어 구조를 캐싱하는 메모리 공간이다.

![image-20210809223540919](C:\Users\mkjung.KSYSTEM\AppData\Roaming\Typora\typora-user-images\image-20210809223540919.png)



소프트파싱(Soft Parsing)

- SQL을 캐시에서 찾아 곧바로 실행 단계로 넘어가는 것



하드 파싱(Hard Parsing)

- 캐시에 존재하지 않아 최적화 및 로우 소스 생성단계 까지 모두 거치는 것



옵티마이저는 단 하나의 쿼리를 실행할 때도 SQL 최적화 과정에 있어 옵티마이저는 테이블 간 조인, 조인 방법, 인덱스 스캔 등 짧은 시간에 엄청난 수의 연산을 실행한다. 때문에 CPU를 상당히 많이 소모하는 최적화 과정은 상당히 하드하며 이 때문에 라이브러리 캐시를 통해 효율을 최대화해야만 한다.



### 바인드 변수의 중요성

사용자정의함수, 프로시저, 트리거 등은 생성 시점에 이름이 부여되며 컴파일한 상태로 딕셔너리에 저장되고 사용자가 삭제하지 않는 이상 영구히 보관된다. 또한 라이브러리 캐시에 적재되어 다수의 사용자가 공유하며 재사용할 수 있다. 



일회성(ad hoc) SQL의 경우 각각에 ID가 부여되고 공백하나의 차이도 각 SQL에 다른 ID가 부여되기 때문에 동일한 기능을 하는 SQL 일지라도 각각 라이브러리 캐시에 저장된다. 이럴 경우 매 실행 하드 파싱이 발생하기 때문에 I/O 가 많아지게 되며 성능에 부하가 생길 수 있다. 이 경우 Driven 방식의 SQL 작성을 통해 라이브러리 캐시에 적재된 계획을 공유하여 사용할 수 있다.